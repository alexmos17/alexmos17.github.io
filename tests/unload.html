<html>
<body>
<script>
function addUnloadImg() {
  window.addEventListener('unload', function () { 
    var img = document.createElement("img"); 
    img.src = document.getElementById("basepath").value + "foo.jpg"; 
    document.body.appendChild(img); 
  });
}

function addUnloadScript() {
  window.addEventListener('unload', function () { 
    var script = document.createElement("script"); 
    script.src = document.getElementById("basepath").value + "foo.js"; 
    document.body.appendChild(script); 
  });
}
  
function addUnloadXHR(async) {
  window.addEventListener('unload', function () { 
    var r = new XMLHttpRequest();
    r.open('GET', 'http://127.0.0.1:8000/index.html', async);
    r.send(null);
  });
}

function addUnloadBeacon() {
  window.addEventListener('unload', function () { 
    navigator.sendBeacon("http://127.0.0.1:8000/foo", "bar");  
  });
}

function addUnloadConsoleLog() {
  window.addEventListener('unload', function () { 
    console.log("Unload handler ran in " + location.href);
  });
}
    
</script>

Default path for requests from unload: <input type='text' id='basepath' value="http://127.0.0.1:8000/"><br>

<button onclick="addUnloadImg()">Add unload (img)</button>
<button onclick="addUnloadScript()">Add unload (script)</button>
<button onclick="addUnloadXHR(false)">Add unload (sync xhr)</button>
<button onclick="addUnloadXHR(true)">Add unload (async xhr)</button>
<button onclick="addUnloadBeacon()">Add unload (sendBeacon)</button>
<button onclick="addUnloadConsoleLog()">Add unload (console.log)</button>
<br clear=all>
<!-- will become an OOPIF if main frame is loaded over HTTP -->
<iframe src="https://alexmos17.github.io/tests/unload-frame.html"></iframe>

</body>
</html>
